<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ğŸ“… ä»Šæ—¥ã¯ä½•ã®æ—¥ï¼Ÿ - ã²ã¾ã¤ã¶ã—ã¨å­¦ã³ã®åº­</title>
<style>
  body{font-family:"Noto Sans JP",sans-serif;background:linear-gradient(180deg,#fff,#f7fbff);margin:0;display:flex;flex-direction:column;min-height:100vh;align-items:center;}
  header{width:100%;background:#4a90e2;color:white;padding:12px;text-align:center;font-weight:700;}
  main{flex:1;width:100%;max-width:900px;padding:18px;}
  .card{background:white;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06);margin-bottom:12px;}
  .sources{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;}
  a.button{display:inline-block;padding:8px 12px;border-radius:8px;background:#eef6ff;color:#0366d6;text-decoration:none;font-weight:700;border:1px solid #d6eaff;}
</style>
</head>
<body>
<header>ğŸ“… ä»Šæ—¥ã¯ä½•ã®æ—¥ï¼Ÿ â€” ã²ã¾ã¤ã¶ã—ã¨å­¦ã³ã®åº­</header>
<main>
  <div id="todayCard" class="card">èª­ã¿è¾¼ã¿ä¸­â€¦</div>
  <div id="results"></div>
  <div style="margin-top:10px;">
    <button onclick="location.href='index.html'">ğŸ¡ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
  </div>
</main>

<script>
async function fetchJSON(url){
  try{
    const r = await fetch(url);
    if(!r.ok) throw new Error('HTTP ' + r.status);
    const ct = r.headers.get('content-type') || '';
    if(ct.includes('application/json')) return await r.json();
    return await r.text();
  } catch(e){
    console.warn('fetch failed', url, e);
    return null;
  }
}

async function loadToday(){
  const now = new Date();
  const m = now.getMonth() + 1;
  const d = now.getDate();
  document.getElementById('todayCard').textContent = `ä»Šæ—¥ï¼š${m}æœˆ${d}æ—¥ï¼ˆè‡ªå‹•å–å¾—ï¼‰ â€” å¤–éƒ¨ã‚½ãƒ¼ã‚¹ã‹ã‚‰ã€Œä»Šæ—¥ã¯ä½•ã®æ—¥ã€ã‚’ã¾ã¨ã‚ã¾ã™ã€‚`;

  const sources = []; // {title, url, snippet}

  // 1) Wikipedia REST On This Day (try)
  const wikiUrl = `https://en.wikipedia.org/api/rest_v1/feed/onthisday/all/${m}/${d}`;
  const wikiData = await fetchJSON(wikiUrl);
  if(wikiData && wikiData.events && wikiData.events.length){
    let snippet = wikiData.events.slice(0,3).map(ev=>{
      const year = ev.year;
      const desc = ev.text ? ev.text : (ev.pages && ev.pages[0] && ev.pages[0].extract ? ev.pages[0].extract : '');
      return `${year} â€” ${desc}`;
    }).join('\n\n');
    sources.push({title:'Wikipedia â€” On this day (en)', url:wikiUrl, snippet});
  }

  // 2) History.MuffinLabs (simple API)
  const muffinUrl = `https://history.muffinlabs.com/date/${m}/${d}`;
  const muffinData = await fetchJSON(muffinUrl);
  if(muffinData && muffinData.data && muffinData.data.Events && muffinData.data.Events.length){
    const snippet = muffinData.data.Events.slice(0,3).map(ev=>`${ev.year} â€” ${ev.text}`).join('\n\n');
    sources.push({title:'History - muffinlabs (on this day)', url:muffinUrl, snippet});
  }

  // 3) timeanddate on-this-day (fetch page as fallback)
  const timeUrl = `https://www.timeanddate.com/on-this-day/${m}-${d}`;
  const timeText = await fetchJSON(timeUrl);
  if(timeText){
    sources.push({title:'timeanddate â€” On this day', url:timeUrl, snippet:'(ãƒšãƒ¼ã‚¸ãŒå–å¾—ã§ãã¾ã—ãŸã€‚ä¸»è¦å‡ºæ¥äº‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚)'});
  }

  // 4) æ—¥æœ¬ã®ã€Œä»Šæ—¥ã¯ä½•ã®æ—¥ã€ã‚µã‚¤ãƒˆï¼ˆä¾‹: kids.yahoo / netlabï¼‰
  const jpUrl = `https://kids.yahoo.co.jp/today/${String(m).padStart(2,'0')}${String(d).padStart(2,'0')}`;
  const jpText = await fetchJSON(jpUrl);
  if(jpText){
    sources.push({title:'Yahoo!ãã£ãš â€” ä»Šæ—¥ã¯ä½•ã®æ—¥', url:jpUrl, snippet:'(æ—¥æœ¬èªã®è¨˜å¿µæ—¥ãƒ»å‡ºæ¥äº‹ã®ã¾ã¨ã‚ãƒšãƒ¼ã‚¸)'});
  }

  // If none fetched, provide search fallback
  if(sources.length === 0){
    const googleSearch = `https://www.google.com/search?q=${encodeURIComponent(m+'æœˆ'+d+'æ—¥ ä»Šæ—¥ã¯ä½•ã®æ—¥')}`;
    document.getElementById('results').innerHTML = `
      <div class="card">
        å¤–éƒ¨ã‚µã‚¤ãƒˆã®å–å¾—ã«å¤±æ•—ã—ãŸã‹ã€CORS ã®åˆ¶é™ãŒã‹ã‹ã£ã¦ã„ã¾ã™ã€‚<br>
        ä¸‹ã®æ¤œç´¢ãƒªãƒ³ã‚¯ã‚’è©¦ã—ã¦ã­ï¼š<br><a class="button" href="${googleSearch}" target="_blank" rel="noopener">ğŸ” Google æ¤œç´¢ã§èª¿ã¹ã‚‹</a>
      </div>`;
    return;
  }

  // show top 3 sources (å…ˆã«å–å¾—ã§ããŸé †)
  const top = sources.slice(0,3);
  const out = document.getElementById('results');
  out.innerHTML = '';
  top.forEach((s,i)=>{
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `<div style="font-weight:800">${i+1}. ${s.title}</div>
      <div style="white-space:pre-wrap;margin-top:8px;font-size:0.95rem;color:#333">${s.snippet || '(æŠœç²‹ãªã—)'}</div>
      <div style="margin-top:8px;">
        <a class="button" href="${s.url}" target="_blank" rel="noopener">ğŸ”— ã‚½ãƒ¼ã‚¹ã‚’é–‹ã</a>
      </div>`;
    out.appendChild(div);
  });

  // ã•ã‚‰ã«ã€Œè‡ªå­¦ãƒã‚¿100å€‹ã€ã¸ã®ãƒªãƒ³ã‚¯
  const studyCard = document.createElement('div');
  studyCard.className='card';
  studyCard.innerHTML = `<div style="font-weight:800">è‡ªå­¦ãƒã‚¿ï¼ˆã¾ã¨ã‚ï¼‰</div>
    <div style="margin-top:8px;">è‡ªå­¦ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’ 100 å€‹ã¾ã¨ã‚ãŸãƒšãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã™ â†’ <a class="button" href="study.html">è‡ªå­¦ãƒã‚¿100</a></div>`;
  out.appendChild(studyCard);
}

loadToday();
</script>
</body>
</html>
